# Bifrost Bazel Configuration
# Enable Bzlmod for modern dependency management
common --enable_bzlmod

# Python 3.13 compatibility and PyO3 settings
build --action_env=PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1
build --action_env=PYTHON_VERSION=3.13

# Performance optimizations
build --show_result=1
build --symlink_prefix=bazel-
build --jobs=auto
build --local_ram_resources=HOST_RAM*.75
build --local_cpu_resources=HOST_CPUS

# Developer experience improvements
build --color=yes
test --test_output=errors
test --test_summary=detailed

# CI/CD optimizations
build:ci --loading_phase_threads=1
build:ci --jobs=4
build:ci --local_ram_resources=2048
build:ci --local_cpu_resources=4
build:ci --verbose_failures
build:ci --test_output=all

# Remote caching configuration (for future CI/CD)
# build --remote_cache=...
# build --remote_timeout=60
# build --remote_upload_local_results=true
# build --remote_local_fallback=true

# Platform-specific configurations
build:linux --action_env=CC=clang
build:macos --action_env=CC=clang
build:windows --action_env=CC=cl.exe

# Rust configuration for future use
build --@rules_rust//rust/toolchain/channel=stable

# Memory optimization for large builds
build --experimental_repository_cache_hardlinks
build --experimental_guard_against_concurrent_changes

# Cross-platform build support
build:cross-linux --platforms=@io_bazel_rules_go//go/toolchain:linux_amd64
build:cross-macos --platforms=@io_bazel_rules_go//go/toolchain:darwin_amd64
build:cross-windows --platforms=@io_bazel_rules_go//go/toolchain:windows_amd64
